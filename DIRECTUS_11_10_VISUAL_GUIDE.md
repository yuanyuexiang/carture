# ğŸ“± Directus 11.10.0 å¯è§†åŒ–æ“ä½œæŒ‡å—

## ğŸ¯ ç›®æ ‡ï¼šä¿®æ”¹ visits è¡¨å­—æ®µé…ç½®

### ç¬¬ä¸€æ­¥ï¼šç™»å½• Directus Admin

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š`https://forge.matrix-net.tech/admin`
2. è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç ç™»å½•

### ç¬¬äºŒæ­¥ï¼šè¿›å…¥æ•°æ®æ¨¡å‹è®¾ç½®

```
1. åœ¨å·¦ä¾§å¯¼èˆªæ æœ€ä¸‹æ–¹ï¼Œç‚¹å‡» ã€é½¿è½®å›¾æ ‡ âš™ï¸ã€‘
2. ä»å¼¹å‡ºèœå•ä¸­é€‰æ‹© ã€Data Modelã€‘
```

### ç¬¬ä¸‰æ­¥ï¼šæ‰¾åˆ°å¹¶ç¼–è¾‘ visits è¡¨

```
1. åœ¨æ•°æ®æ¨¡å‹é¡µé¢ä¸­ï¼Œæ‰¾åˆ° ã€visitsã€‘ è¡¨
2. ç‚¹å‡» ã€visitsã€‘ è¿›å…¥è¯¥è¡¨çš„è¯¦æƒ…é¡µé¢
```

### ç¬¬å››æ­¥ï¼šä¿®æ”¹ customer å­—æ®µ

```
1. åœ¨ visits è¡¨çš„å­—æ®µåˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ° ã€customerã€‘ å­—æ®µ
2. ç‚¹å‡»å­—æ®µåå³ä¾§çš„ ã€ç¼–è¾‘å›¾æ ‡ âœï¸ã€‘ æˆ–ç›´æ¥ç‚¹å‡»å­—æ®µå
```

#### åœ¨å­—æ®µç¼–è¾‘é¡µé¢è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š

**åŸºç¡€ä¿¡æ¯ (General) æ ‡ç­¾é¡µï¼š**
- Key: `customer` (ä¸è¦ä¿®æ”¹)
- Type: ç¡®ä¿æ˜¾ç¤ºä¸º `Many-to-One Relation`

**æ¥å£ (Interface) æ ‡ç­¾é¡µï¼š**
- Interface: é€‰æ‹© `Many-to-One`
- Display Template: è¾“å…¥ `{{nick_name}} ({{id}})`
- å¦‚æœæœ‰ "Enable Create" é€‰é¡¹ï¼Œå¯ä»¥å–æ¶ˆå‹¾é€‰

**å…³ç³» (Relation) æ ‡ç­¾é¡µï¼š**
- Related Collection: ç¡®ä¿è®¾ç½®ä¸º `customers`
- Foreign Key Field: åº”è¯¥æ˜¯ `customer`
- One Collection Field: å¯èƒ½æ˜¯ `visits` æˆ–ç•™ç©º

**éªŒè¯ (Validation) æ ‡ç­¾é¡µï¼š**
- Required: æ ¹æ®éœ€è¦å‹¾é€‰ï¼ˆå»ºè®®å‹¾é€‰ï¼‰

**é«˜çº§ (Advanced) æ ‡ç­¾é¡µï¼š**
- ç¡®ä¿æ²¡æœ‰ç‰¹æ®Šé™åˆ¶å½±å“ GraphQL

### ç¬¬äº”æ­¥ï¼šä¿®æ”¹ boutique å­—æ®µ

é‡å¤ç¬¬å››æ­¥çš„æ“ä½œï¼Œå¯¹ `boutique` å­—æ®µè¿›è¡Œé…ç½®ï¼š
- Display Template è®¾ç½®ä¸º: `{{name}} ({{id}})`
- Related Collection è®¾ç½®ä¸º: `boutiques`

### ç¬¬å…­æ­¥ï¼šä¿å­˜å¹¶åº”ç”¨æ›´æ”¹

```
1. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ ã€Saveã€‘ æŒ‰é’®ä¿å­˜ customer å­—æ®µ
2. é‡å¤ä¿å­˜ boutique å­—æ®µçš„æ›´æ”¹
3. å›åˆ° Data Model ä¸»é¡µé¢
```

### ç¬¬ä¸ƒæ­¥ï¼šåˆ·æ–° Schema ç¼“å­˜

```
æ–¹å¼ä¸€ï¼šé€šè¿‡ Admin é¢æ¿
1. è¿˜æ˜¯åœ¨ Settings ä¸­ï¼Œæ‰¾åˆ° ã€Project Settingsã€‘
2. å¦‚æœæœ‰ "Clear Cache" æˆ– "Refresh Schema" æŒ‰é’®ï¼Œç‚¹å‡»å®ƒ

æ–¹å¼äºŒï¼šé‡å¯ Directus æœåŠ¡ï¼ˆæ¨èï¼‰
```

å¦‚æœæ‚¨æœ‰æœåŠ¡å™¨è®¿é—®æƒé™ï¼š
```bash
# æŸ¥æ‰¾ Directus è¿›ç¨‹
pm2 list

# é‡å¯ Directus
pm2 restart directus

# æˆ–è€…å¦‚æœä½¿ç”¨ Docker
docker restart directus-container
```

### ç¬¬å…«æ­¥ï¼šéªŒè¯é…ç½®

#### 8.1 æ£€æŸ¥ GraphQL Schema
1. è®¿é—®ï¼š`https://forge.matrix-net.tech/graphql`
2. åœ¨å³ä¾§ Schema é¢æ¿ä¸­æœç´¢ `create_visits_input`
3. æŸ¥çœ‹æ˜¯å¦å˜æˆï¼š
```graphql
input create_visits_input {
  customer: ID      # â† åº”è¯¥æ˜¯ ID ç±»å‹
  boutique: ID      # â† åº”è¯¥æ˜¯ ID ç±»å‹
  date_created: Date
  # ...å…¶ä»–å­—æ®µ
}
```

#### 8.2 æµ‹è¯• Mutation
åœ¨ GraphQL Playground ä¸­è¿è¡Œï¼š
```graphql
mutation TestVisitCreation {
  create_visits_item(data: {
    customer: "1"
    boutique: "1"
  }) {
    id
    date_created
  }
}
```

**é¢„æœŸç»“æœ**: ä¸å†å‡ºç° `open_id` ç›¸å…³é”™è¯¯

## ğŸš¨ å¸¸è§é—®é¢˜æ’é™¤

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ° Settings èœå•
- **è§£å†³**: ç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼Œæ™®é€šç”¨æˆ·å¯èƒ½çœ‹ä¸åˆ°è®¾ç½®é€‰é¡¹

### é—®é¢˜2ï¼šå­—æ®µç±»å‹æ— æ³•ä¿®æ”¹
- **è§£å†³**: å¯èƒ½éœ€è¦å…ˆåˆ é™¤ç°æœ‰å…³ç³»ï¼Œå†é‡æ–°å»ºç«‹

### é—®é¢˜3ï¼šGraphQL Schema æ²¡æœ‰æ›´æ–°
- **è§£å†³**: 
  1. é‡å¯ Directus æœåŠ¡
  2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
  3. ç­‰å¾…å‡ åˆ†é’Ÿè®©ç³»ç»Ÿè‡ªåŠ¨åˆ·æ–°

### é—®é¢˜4ï¼šæƒé™é”™è¯¯
- **è§£å†³**: æ£€æŸ¥è§’è‰²æƒé™ï¼Œç¡®ä¿å¯¹ visits è¡¨æœ‰å®Œæ•´çš„ CRUD æƒé™

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ‚¨åœ¨å“ªä¸€æ­¥é‡åˆ°å›°éš¾
2. å±å¹•æˆªå›¾ï¼ˆå¦‚æœå¯èƒ½ï¼‰
3. é”™è¯¯ä¿¡æ¯çš„å…·ä½“å†…å®¹
4. å½“å‰çœ‹åˆ°çš„å­—æ®µé…ç½®æˆªå›¾

æˆ‘å°†æ ¹æ®å…·ä½“æƒ…å†µæä¾›è¿›ä¸€æ­¥çš„ååŠ©ï¼

## âœ… æˆåŠŸæ ‡å¿—

é…ç½®æˆåŠŸåï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°ï¼š
1. visits è¡¨çš„ customer å’Œ boutique å­—æ®µæ˜¾ç¤ºä¸º "Many-to-One Relation"
2. GraphQL Schema ä¸­ `create_visits_input` çš„å­—æ®µç±»å‹ä¸º `ID`
3. GraphQL Mutation æµ‹è¯•æˆåŠŸï¼Œæ—  `open_id` é”™è¯¯